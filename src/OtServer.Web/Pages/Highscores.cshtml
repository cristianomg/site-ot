@page
@model HighscoresModel
@{
    ViewData["Title"] = "Highscores das Trevas";
    var rankingTitle = Model.CurrentRankingType switch 
    {
        RankingType.Level => "‚≠ê Level & Resets",
        RankingType.MagicLevel => "üîÆ Magic Level", 
        RankingType.Fist => "üõ°Ô∏è Fist Fighting",
        RankingType.Sword => "‚öîÔ∏è Sword Fighting",
        RankingType.Distance => "üèπ Distance Fighting", 
        RankingType.Axe => "ü™ì Axe Fighting",
        RankingType.Club => "üî® Club Fighting",
        _ => "‚≠ê Level & Resets"
    };
}

<div class="text-center mb-4">
    <h1 class="glow">‚öîÔ∏è Highscores das Trevas ‚öîÔ∏è</h1>
    <p class="lead" style="font-size: 1.3rem; color: #ff6b47;">As almas mais poderosas das masmorras sombrias!</p>
    <p style="color: #ff6b47; font-style: italic;">"@rankingTitle - Apenas os mais corrompidos chegam ao topo..."</p>
</div>

<div class="row">
    <!-- Sidebar de Rankings -->
    <div class="col-lg-3 col-md-4 mb-4">
        <div class="card ranking-sidebar">
            <div class="card-header">
                <h5>üíÄ Tipos de Ranking</h5>
                <small class="text-muted">Escolha sua categoria sombria</small>
            </div>
            <div class="card-body p-2">
                <div class="list-group list-group-flush">
                    <a href="?type=level&page=1" class="list-group-item @(Model.CurrentRankingType == RankingType.Level ? "active" : "")">
                        <div class="d-flex align-items-center">
                            <span class="me-2">‚≠ê</span>
                            <div>
                                <div class="fw-bold">Level & Resets</div>
                                <small class="text-muted">Poder total das almas</small>
                            </div>
                        </div>
                    </a>
                    <a href="?type=magiclevel&page=1" class="list-group-item @(Model.CurrentRankingType == RankingType.MagicLevel ? "active" : "")">
                        <div class="d-flex align-items-center">
                            <span class="me-2">üîÆ</span>
                            <div>
                                <div class="fw-bold">Magic Level</div>
                                <small class="text-muted">Poder arcano sombrio</small>
                            </div>
                        </div>
                    </a>
                    <a href="?type=fist&page=1" class="list-group-item @(Model.CurrentRankingType == RankingType.Fist ? "active" : "")">
                        <div class="d-flex align-items-center">
                            <span class="me-2">üõ°Ô∏è</span>
                            <div>
                                <div class="fw-bold">Fist Fighting</div>
                                <small class="text-muted">Combate sem armas</small>
                            </div>
                        </div>
                    </a>
                    <a href="?type=sword&page=1" class="list-group-item @(Model.CurrentRankingType == RankingType.Sword ? "active" : "")">
                        <div class="d-flex align-items-center">
                            <span class="me-2">‚öîÔ∏è</span>
                            <div>
                                <div class="fw-bold">Sword Fighting</div>
                                <small class="text-muted">Mestres da l√¢mina</small>
                            </div>
                        </div>
                    </a>
                    <a href="?type=distance&page=1" class="list-group-item @(Model.CurrentRankingType == RankingType.Distance ? "active" : "")">
                        <div class="d-flex align-items-center">
                            <span class="me-2">üèπ</span>
                            <div>
                                <div class="fw-bold">Distance Fighting</div>
                                <small class="text-muted">Arqueiros das trevas</small>
                            </div>
                        </div>
                    </a>
                    <a href="?type=axe&page=1" class="list-group-item @(Model.CurrentRankingType == RankingType.Axe ? "active" : "")">
                        <div class="d-flex align-items-center">
                            <span class="me-2">ü™ì</span>
                            <div>
                                <div class="fw-bold">Axe Fighting</div>
                                <small class="text-muted">Guerreiros do machado</small>
                            </div>
                        </div>
                    </a>
                    <a href="?type=club&page=1" class="list-group-item @(Model.CurrentRankingType == RankingType.Club ? "active" : "")">
                        <div class="d-flex align-items-center">
                            <span class="me-2">üî®</span>
                            <div>
                                <div class="fw-bold">Club Fighting</div>
                                <small class="text-muted">Mestres do martelo</small>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- √Årea principal da tabela -->
    <div class="col-lg-9 col-md-8">
        <div class="card">
            <div class="card-header">
                <h3>üíÄ Ranking das Almas Perdidas</h3>
                <p class="mb-0 text-muted">
                    <small>
                        √öltima atualiza√ß√£o: @DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss")
                        | Total de almas: @Model.TotalPlayers
                        | P√°gina @Model.CurrentPage de @Model.TotalPages
                        | Mostrando @Model.Players.Count almas
                    </small>
                </p>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead>
                            @if (Model.CurrentRankingType == RankingType.MagicLevel || 
                              Model.CurrentRankingType == RankingType.Fist ||
                              Model.CurrentRankingType == RankingType.Sword ||
                              Model.CurrentRankingType == RankingType.Distance ||
                              Model.CurrentRankingType == RankingType.Axe ||
                              Model.CurrentRankingType == RankingType.Club)
                            {
                                <tr>
                                    <th style="width: 60px; text-align: center;">
                                        <span class="text-warning">#</span>
                                    </th>
                                    <th style="width: 200px;">
                                        <span class="text-warning">üë§ Nome</span>
                                    </th>
                                    <th style="width: 120px; text-align: center;">
                                        @{
                                            var skillHeader = Model.CurrentRankingType switch 
                                            {
                                                RankingType.MagicLevel => "üîÆ Magic Level",
                                                RankingType.Fist => "üõ°Ô∏è Fist Skill",
                                                RankingType.Sword => "‚öîÔ∏è Sword Skill", 
                                                RankingType.Distance => "üèπ Distance Skill",
                                                RankingType.Axe => "ü™ì Axe Skill",
                                                RankingType.Club => "üî® Club Skill",
                                                _ => "Skill"
                                            };
                                        }
                                        <span class="text-warning">@skillHeader</span>
                                    </th>
                                </tr>
                            }
                            else
                            {
                                <tr>
                                    <th style="width: 60px; text-align: center;">
                                        <span class="text-warning">#</span>
                                    </th>
                                    <th style="width: 200px;">
                                        <span class="text-warning">üë§ Nome</span>
                                    </th>
                                    <th style="width: 150px;">
                                        <span class="text-warning">üé≠ Voca√ß√£o</span>
                                    </th>
                                    @if (Model.CurrentRankingType == RankingType.Level)
                                    {
                                        <th style="width: 100px; text-align: center;">
                                            <span class="text-warning">üîÑ Resets</span>
                                        </th>
                                        <th style="width: 100px; text-align: center;">
                                            <span class="text-warning">‚≠ê Level</span>
                                        </th>
                                        <th style="text-align: right;">
                                            <span class="text-warning">üíé Experience</span>
                                        </th>
                                    }
                                </tr>
                            }
                        </thead>
                        <tbody>
                            @foreach (var player in Model.Players)
                            {
                                if (Model.CurrentRankingType == RankingType.MagicLevel || 
                                    Model.CurrentRankingType == RankingType.Fist ||
                                    Model.CurrentRankingType == RankingType.Sword ||
                                    Model.CurrentRankingType == RankingType.Distance ||
                                    Model.CurrentRankingType == RankingType.Axe ||
                                    Model.CurrentRankingType == RankingType.Club)
                                {
                                    <tr>
                                        <td style="text-align: center;">
                                            @if (player.Position == 1)
                                            {
                                                <span class="badge bg-warning text-dark">ü•á @player.Position</span>
                                            }
                                            else if (player.Position == 2)
                                            {
                                                <span class="badge bg-secondary">ü•à @player.Position</span>
                                            }
                                            else if (player.Position == 3)
                                            {
                                                <span class="badge bg-warning text-dark" style="background: #cd7f32 !important;">ü•â @player.Position</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">@player.Position</span>
                                            }
                                        </td>
                                        <td>
                                            <a href="/Character/@player.Name" class="text-warning" style="text-decoration:underline;">@player.Name</a>
                                        </td>
                                        <td style="text-align: center;">
                                            @{
                                                var skillValue = 0;
                                                if (Model.CurrentRankingType == RankingType.MagicLevel)
                                                {
                                                    skillValue = player.MagicLevel;
                                                }else {
                                                    skillValue = player.SkillLevel;
                                                }

                                                var skillColor = skillValue >= 130 ? "text-danger" : 
                                                               skillValue >= 100 ? "text-warning" : 
                                                               skillValue >= 70 ? "text-info" : "text-muted";
                                            }
                                            <strong class="@skillColor">@skillValue</strong>
                                        </td>
                                    </tr>
                                }
                                else
                                {
                                    <tr>
                                        <td style="text-align: center;">
                                            @if (player.Position == 1)
                                            {
                                                <span class="badge bg-warning text-dark">ü•á @player.Position</span>
                                            }
                                            else if (player.Position == 2)
                                            {
                                                <span class="badge bg-secondary">ü•à @player.Position</span>
                                            }
                                            else if (player.Position == 3)
                                            {
                                                <span class="badge bg-warning text-dark" style="background: #cd7f32 !important;">ü•â @player.Position</span>
                                            }
                                            else
                                            {
                                                <span class="text-muted">@player.Position</span>
                                            }
                                        </td>
                                        <td>
                                            <a href="/Character/@player.Name" class="text-warning" style="text-decoration:underline;">@player.Name</a>
                                        </td>
                                        <td>
                                            @switch (player.Vocation)
                                            {
                                                case "Knight":
                                                    <span class="text-info">‚öîÔ∏è @player.Vocation</span>
                                                    break;
                                                case "Sorcerer":
                                                    <span class="text-danger">üî• @player.Vocation</span>
                                                    break;
                                                case "Druid":
                                                    <span class="text-success">üåø @player.Vocation</span>
                                                    break;
                                                case "Archer":
                                                    <span class="text-warning">üèπ @player.Vocation</span>
                                                    break;
                                                case "Master Sorcerer":
                                                    <span class="text-danger">üî• @player.Vocation</span>
                                                    break;
                                                case "Elder Druid":
                                                    <span class="text-success">üåø @player.Vocation</span>
                                                    break;
                                                case "Royal Archer":
                                                    <span class="text-warning">üèπ @player.Vocation</span>
                                                    break;
                                                case "Elite Knight":
                                                    <span class="text-info">‚öîÔ∏è @player.Vocation</span>
                                                    break;
                                                case "Wyzard":
                                                    <span class="text-danger">üî• @player.Vocation</span>
                                                    break;
                                                case "Cleric":
                                                    <span class="text-success">üåø @player.Vocation</span>
                                                    break;
                                                case "Ranger":
                                                    <span class="text-warning">üèπ @player.Vocation</span>
                                                    break;
                                                case "Slayer":
                                                    <span class="text-info">‚öîÔ∏è @player.Vocation</span>
                                                    break;
                                                case "Dark Wyzard":
                                                    <span class="text-danger">üî• @player.Vocation</span>
                                                    break;
                                                case "Elemental Cleric":
                                                    <span class="text-success">üåø @player.Vocation</span>
                                                    break;
                                                case "Elven Ranger":
                                                    <span class="text-warning">üèπ @player.Vocation</span>
                                                    break;
                                                case "Dragon Slayer":
                                                    <span class="text-info">‚öîÔ∏è @player.Vocation</span>
                                                    break;
                                                default:
                                                    <span>@player.Vocation</span>
                                                    break;
                                            }
                                        </td>
                                        @if (Model.CurrentRankingType == RankingType.Level)
                                        {
                                            <td style="text-align: center;">
                                                @if (player.Resets >= 10)
                                                {
                                                    <span class="badge bg-danger">üíÄ @player.Resets</span>
                                                }
                                                else if (player.Resets >= 5)
                                                {
                                                    <span class="badge bg-warning text-dark">üî• @player.Resets</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-secondary">‚ö° @player.Resets</span>
                                                }
                                            </td>
                                            <td style="text-align: center;">
                                                <strong class="text-warning">@player.Level</strong>
                                            </td>
                                            <td style="text-align: right;">
                                                <span class="text-success">@player.Experience.ToString("N0")</span>
                                            </td>
                                        }
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pagina√ß√£o das Trevas -->
@if (Model.TotalPages > 1)
{
    <div class="row mt-4">
        <div class="col-12">
            <nav aria-label="Navega√ß√£o das Almas Perdidas">
                <ul class="pagination pagination-dark justify-content-center">
                    <!-- Bot√£o Anterior -->
                    <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link" href="?type=@(Model.CurrentRankingType.ToString().ToLower())&page=@(Model.CurrentPage - 1)" aria-label="Anterior">
                            <span aria-hidden="true">üíÄ Anterior</span>
                        </a>
                    </li>

                    <!-- N√∫meros das p√°ginas -->
                    @{
                        int startPage = Math.Max(1, Model.CurrentPage - 2);
                        int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
                        string currentType = Model.CurrentRankingType.ToString().ToLower();
                    }

                    @if (startPage > 1)
                    {
                        <li class="page-item">
                            <a class="page-link" href="?type=@currentType&page=1">1</a>
                        </li>
                        @if (startPage > 2)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                    }

                    @for (int i = startPage; i <= endPage; i++)
                    {
                        <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                            <a class="page-link" href="?type=@currentType&page=@i">
                                @if (i == Model.CurrentPage)
                                {
                                    <strong>üëÅ @i</strong>
                                }
                                else
                                {
                                    @i
                                }
                            </a>
                        </li>
                    }

                    @if (endPage < Model.TotalPages)
                    {
                        @if (endPage < Model.TotalPages - 1)
                        {
                            <li class="page-item disabled">
                                <span class="page-link">...</span>
                            </li>
                        }
                        <li class="page-item">
                            <a class="page-link" href="?type=@currentType&page=@Model.TotalPages">@Model.TotalPages</a>
                        </li>
                    }

                    <!-- Bot√£o Pr√≥ximo -->
                    <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                        <a class="page-link" href="?type=@currentType&page=@(Model.CurrentPage + 1)" aria-label="Pr√≥ximo">
                            <span aria-hidden="true">Pr√≥ximo üî•</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
}

<!-- Estat√≠sticas das Trevas -->
<div class="row mt-5">
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="text-danger">üíÄ</h2>
                <h5>Maior Reset</h5>
                <p class="text-warning"><strong>@Model.AllPlayers.Max(p => p.Resets)</strong></p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="text-warning">‚≠ê</h2>
                <h5>Maior Level</h5>
                <p class="text-warning"><strong>@Model.AllPlayers.Max(p => p.Level)</strong></p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="text-success">üíé</h2>
                <h5>Maior EXP</h5>
                <p class="text-warning"><strong>@Model.AllPlayers.Max(p => p.Experience).ToString("N0")</strong></p>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h2 class="text-info">üë•</h2>
                <h5>Almas Totais</h5>
                <p class="text-warning"><strong>@Model.TotalPlayers</strong></p>
            </div>
        </div>
    </div>
</div>

<!-- Call to Action -->
<div class="card bg-gradient text-center mt-4">
    <div class="card-body">
        <h2 class="glow" style="color: #ff6b47;">üëÅ Sua Alma Est√° na Lista? üëÅ</h2>
        <p class="lead" style="color: #ff6b47; font-weight: bold;">"Apenas os mais corrompidos alcan√ßam o topo das trevas..."</p>
        <p>Crie sua conta e comece sua jornada rumo ao poder absoluto!</p>
        <div class="mt-4">
            <button class="btn btn-warning btn-lg me-3" onclick="alert('Sistema de cria√ß√£o de conta em breve!')">üî• Despertar Alma</button>
            <button class="btn btn-outline-light btn-lg" onclick="alert('Download em breve!')">üíÄ Download Client</button>
        </div>
    </div>
</div> 
</div> 